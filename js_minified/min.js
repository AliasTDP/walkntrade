function initAddPost(){window.uploadedImages=0;window.clear=true}function initResults(){window.category="All";window.sort=0;window.offset=0;window.lastCat="";window.canvas="#dynamicContent";window.scrolling=false;window.inhibitUpdate=false;window.resultsPageActive=true;$.ajaxSetup({url:api_url,dataType:"xml",type:"POST",timeout:15e3});$(document).ajaxStart(function(){document.getElementById("throbber").style.display="block"});$(document).ajaxComplete(function(){document.getElementById("throbber").style.display="none"});$(document).ajaxError(function(){dialog("<h2>Hmmm, something's not right here</h2><p>We are having a problem connecting to walkNtrade. Please check your internet connection and try again.</p>",true)});$(document).ready(function(){resizeListings();pageLoad($("#queryBar").val(),window.school,window.category,window.sort,null);$("#dump").append("<ul></ul>");$("#filterBar").find("a").click(updatePage);$("#Nav li").click(function(){window.category=this.getAttribute("id");updatePage()});$(window).scroll(function(e){if($(this).scrollTop()>64){var t=$("#mainCWB").width();$("#Nav").css({width:t});$("#Nav").css({position:"fixed",top:"0px"})}else if($(this).scrollTop()<=185){$("#Nav").css({position:"inherit"});$("#Nav").css({width:"100%"})}var n=($("body").height()-$(window).scrollTop())/$("body").height();if(window.scrolling&&n<$(window).height()/$("body").height()){pageLoad($("#queryBar").val(),window.school,window.category,window.sort,null);window.scrolling=false}});$(window).resize(function(){if($(this).scrollTop()>146){var e=$("#mainCWB").width();$("#Nav").css({width:e})}resizeListings()})})}function initCP(){window.includeDir="/include/user_settings/";window.sections=new Array('<i class="sprite sprite-1396343029_shop"></i>Welcome','<i class="sprite sprite-1396343080_mail"></i>Received Messages','<i class="sprite sprite-1396343166_paperplane"></i>Sent Messages','<i class="sprite sprite-1396343050_news"></i>Your Posts','<i class="sprite sprite-1396343908_settings"></i>Account Settings','<i class="sprite sprite-1396343345_user"></i>Profile Settings','<i class="sprite sprite-1396343039_like"></i>Contact Preferences');window._preventDefault;window.jumpTo;window.cpModule=new Array;window.avatar;window.username;$.ajaxSetup({url:api_url,type:"POST",timeout:15e3});$.holdReady(true);for(var e=0;e<sections.length;e++){$.ajax({url:includeDir+e+".html",dataType:"html",type:"GET",context:Array(e,sections.length)}).done(function(e){cpModule[this[0]]=e;if(this[0]==this[1]-1){$.ajax({data:"intent=getUserName"}).done(function(e){$.ajax({data:"intent=getAvatar"}).done(function(t){window.avatar=new Image;window.avatar.src=t;window.username=e;$.holdReady(false)})})}})}$(document).ajaxStart(function(){document.getElementById("throbber").style.display="block"});$(document).ajaxComplete(function(){document.getElementById("throbber").style.display="none"});$(document).ajaxError(function(){dialog("<h2>Hmmm, something's not right here</h2><p>We are having a problem connecting to walkNtrade. Please check your internet connection and try again.</p>",true)});$(document).ready(function(){$("#userModule").html('<div id="avatar"><img width="50px" height="50px" src="'+window.avatar.src+'"></div><div id="uName">'+window.username+"</div>");var e=location.hash.slice(1);if(e!=""){$("#contentTab").html(cpModule[e]);var t=true}else{$("#contentTab").html(cpModule[0]);var t=false}$("#navBar").append("<ul></ul>");for(var n=0;n<sections.length;n++){if(n==0&&!t)$("#navBar ul").append('<li id="'+n+'" class="selected" style="cursor:pointer">'+sections[n]+"</li>");else if(n==e&&t)$("#navBar ul").append('<li id="'+n+'" class="selected" style="cursor:pointer">'+sections[n]+"</li>");else $("#navBar ul").append('<li id="'+n+'" style="cursor:pointer">'+sections[n]+"</li>");$("#"+n).click(function(e){$("#navBar ul").find("li").removeAttr("class");$("#"+e.target.id).attr("class","selected");$("#contentTab").slideUp(200,function(){$("#contentTab").html(cpModule[e.target.id]);$("#contentTab").slideDown(200)})})}$("#screen_solid").fadeOut()})}function initShowPage(){$(document).ready(function(e){$("#imageOne img").click(blowupImage);$("#moreImages img").click(blowupImage)})}function initFeedbackSlider(){function r(){$("#feedbackButton img").click(function(){$("#feedbackWrapper").animate({right:+n},function(){$("#feedbackButton img").unbind();$("#feedbackButton img").click(function(e){$("#feedbackWrapper").animate({right:0});r()});$("body *").keydown(function(e){if(e.keyCode==27)$("#feedbackWrapper").animate({right:0})})})})}var e=20;var t=500;var n=350;$("body").prepend("<div id='feedbackWrapper'></div>");$("#feedbackWrapper").prepend("<div id='feedbackButton'><img src='/colorful/feedback_button.png'></div>");$("#feedbackWrapper").append("<div id='feedbackContent'>		<h1>Let us know what you think!</h1>		<p>Leave us a message below!</p>		<p>		<form name='feedbackForm' action='javascript:submitFeedback()'>		<input name='email' type='text' placeholder='email address (optional)'>		<textarea name='message' placeholder='your message here'></textarea>		<input type='submit' value='Send' class='button'>		</form>		</p>		</div>");r()}function pollNewMessages(){if(window.location.pathname=="/user_settings"||window.location.pathname=="/user_settings.php"){$("#messageIndicator").attr("onclick","javascript:loadModule('1')");$("#postIndicator").attr("onclick","javascript:loadModule('3')");$("#settingsIndicator").attr("onclick","javascript:loadModule('4')")}else{$("#messageIndicator").attr("onclick","window.location = '/user_settings#1'");$("#postIndicator").attr("onclick","window.location = '/user_settings#3'");$("#settingsIndicator").attr("onclick","window.location = '/user_settings#4'")}$.ajax({url:"/api/",dataType:"html",type:"POST",data:"intent=pollNewWebmail"}).success(function(e){var t=parseInt(e);if(t!=="NaN"&&t>0){$("#mNum").slideDown().html(t).css("background","#9CCC65")}})}function setCookie(e,t,n){var r=new Date;r.setDate(r.getDate()+n);var i=escape(t)+(n==null?"":"; expires="+r.toUTCString());document.cookie=e+"="+i+"; path=/"}function popup(e){newwindow=window.open(e,"name","height=580,width=510");if(window.focus){newwindow.focus()}}function changeSchools(){window.location="/selector.php"}function dialog(e,t,n,r){function i(e){$("#screen").fadeOut(function(){$("#screen").remove();if(typeof r==="function"){r(e)}})}function s(){$("body").prepend('<div id="screen"></div>');$("#screen").css("display","none");if(!t)$("#screen").html("<div id='dialog' class='boxStyle1 dialog'></div>");else $("#screen").html("<div class='boxStyle1 dialog'><p style='text-align:center;'><input id='dialogComfirm' type='button' class='button' value='Ok'></div>");if(e!=""){$("#screen div").prepend(e)}if(typeof n==="function"){n()}$("#screen").fadeIn(function(){$("#dialogComfirm").click(function(e){i(true)});$("body").keydown(function(e){if(e.keyCode==27)i(false)});$("#screen").click(function(e){if(e.target!=this)return;i(false)})})}if($("#screen").length!=0){$("#screen").fadeOut(function(){$("#screen").remove();s()})}else s()}function submitFeedback(){var e=document.feedbackForm.email.value;var t=document.feedbackForm.message.value;if(e!=""&&!validateEmail(e)){dialog("Please use a valid email address",true);return}if(t!=""){$.ajax({url:"/api/",dataType:"html",type:"POST",data:"intent=sendFeedback&email="+e+"&message="+t}).success(function(e){$("#feedbackWrapper").animate({right:0});dialog(e,true)})}}function loadModule(e){$("#navBar ul").find("li").removeAttr("class");$("#"+e).attr("class","selected");$("#contentTab").slideUp(200,function(){$("#contentTab").html(cpModule[e]);$("#contentTab").slideDown(200)})}function getWebmail(){$("#navBarMail").html("[Waiting for mail]");$.ajax({dataType:"xml",data:"intent=getWebmail&quiet=true"}).success(function(e){var t=$("#webmail");t.html('<table cellpadding="0" cellspacing="0"></table>');$("#navBarMail").html("["+$(e).find("message").length+"] messages total <input type='button' class='button' value='Reload' onclick='getWebmail()' >");$(e).find("message").each(function(){var e=$(this).attr("id");var n=$(this).attr("from");var r=$(this).attr("subject");var i=$(this).attr("message");var s=$(this).attr("datetime");var o=$(this).attr("read")==0?"unread":"";t.find("table").append($("<tr/>",{onclick:"openMessage('"+e+"', '"+o+"')",id:"msg_"+e,"class":o}));$("#msg_"+e).append($("<td/>",{width:"15%","class":"sender"}).text(n));$("#msg_"+e).append($("<td/>",{width:"30%"}).text(r));$("#msg_"+e).append($("<td/>",{width:"40%"}).text(i));$("#msg_"+e).append($("<td/>",{width:"15%"}).text(s))})})}function getSentWebmail(){$("#navBarMail").html("[Waiting for mail]");$.ajax({dataType:"xml",data:"intent=getSentWebmail&quiet=true"}).success(function(e){var t=$("#webmail");t.html('<table cellpadding="0" cellspacing="0"></table>');$("#navBarMail").html("["+$(e).find("message").length+"] messages total");$(e).find("message").each(function(){var e=$(this).attr("id");var n=$(this).attr("to");var r=$(this).attr("subject");var i=$(this).attr("message");var s=$(this).attr("datetime");t.find("table").append($("<tr/>",{onclick:"openMessageSent('"+e+"')",id:"msg_"+e}));$("#msg_"+e).append($("<td/>",{width:"15%","class":"sender"}).text(n));$("#msg_"+e).append($("<td/>",{width:"30%"}).text(r));$("#msg_"+e).append($("<td/>",{width:"40%"}).text(i));$("#msg_"+e).append($("<td/>",{width:"15%"}).text(s))})})}function openMessage(e,t){$.ajax({dataType:"xml",data:"intent=getMessage&message_id="+e}).success(function(n){if(t=="unread"){pollNewMessages();getWebmail()}var r=$(n).find("message");window.from=r.attr("from");window.subject=r.attr("subject");window.message=r.attr("message");window.datetime=r.attr("datetime");var i='<table cellspacing="0" cellpadding="0" class="messageView"><tr><th width="20%">sender::</th><th id="fromElement" width="80%"></th></tr><tr><th>subject::</th><th id="subjectElement"></th></tr><tr><td colspan="2" height="150px"><div id="messageWrapper"></div></td></tr><tr><td>Sent:</td><td>'+datetime+'</th></td><tr><td width="50%"><button class="button" onclick="javascript:removeMessage('+e+')">Delete message</button></td><td width="50%"><button class="button" onclick="javascript:replyTo()">Reply</button></td><tr></table>';dialog(i,false,function(){$("#subjectElement").text(window.subject);$("#fromElement").text(window.from);$("#messageWrapper").text(window.message)})})}function openMessageSent(e){$.ajax({dataType:"xml",data:"intent=getMessage&message_id="+e}).success(function(t){var n=$(t).find("message");window.to=n.attr("to");window.subject=n.attr("subject");window.message=n.attr("message");window.datetime=n.attr("datetime");var r='<table cellspacing="0" cellpadding="0" class="messageView"><tr><th width="20%">to::</th><th id="toUserElement" width="80%"></th></tr><tr><th>subject::</th><th id="subjectElement"></th></tr><tr><td colspan="2" height="150px"><div id="messageWrapper"></div></td></tr><tr><td>Sent:</td><td>'+datetime+'</th></td><tr><td colspan="2"><button class="button" onclick="javascript:removeMessage('+e+')">Delete message</button></td><tr></table>';dialog(r,false,function(){$("#subjectElement").text(window.subject);$("#toUserElement").text(window.to);$("#messageWrapper").text(window.message)})})}function removeMessage(e){function t(){dialog("Are you sure you want to delete this?",true,null,function(t){if(t){$.ajax({dataType:"html",data:"intent=removeMessage&message_id="+e,context:refreshAll}).success(function(e){if(e==0){this()}else{dialog("An error has occured ("+e+").",true,null,window.reload())}})}else return})}if($("#screen").length!=0){$("#screen").fadeOut(function(){$("#screen").remove();t()})}else t()}function sendReply(e){function t(){$.ajax({dataType:"text",data:"intent=messageUser&userName="+e+"&title="+title+"&message="+message,context:getWebmail}).success(function(e){if(e=="success")dialog("Your message has been sent",true,null,this());else dialog(e,true,null)})}title=document.replyForm.subject.value;message=document.replyForm.message.value;if($("#screen").length!=0){$("#screen").fadeOut(function(){$("#screen").remove();t()})}else t()}function replyTo(){dialog('		<form name="replyForm" action="javascript:void(0)" onSubmit="sendReply(document.replyForm.recipient.value)">		<table id="messageReply">		<tr>		<th colspan="2">Compose message:</th>		</tr>		<tr>		<td width="20%">To:</td>		<td><input name="recipient" id="_recipient" type="text"></td>		</tr>		<tr>		<td width="20%">Subject:</td>		<td><input type="text" name="subject" id="_subject"></td>		</tr>		<tr>		<td colspan="2"><textarea name="message"></textarea></td>		</tr>		<tr>		<td colspan="2"><input type="submit" value="Send!"><td>		</tr>		</table>		</form>',false,function(){$("#_recipient").val(window.from);$("#_subject").val("RE: "+window.subject)},null)}function getUserPosts(){$("#yourPosts").append($("<h3/>"));$("#yourPosts h3").text("Loading...");$.ajax({dataType:"xml",data:"intent=getPostsCurrentUser"}).success(function(e){function n(){$("table .CFExpired, .CFExpiring").remove();$("table tr").css({background:"",color:""})}var t=$("#yourPosts");t.html("");if($(e).find("school").length==0){$("#yourPosts").append($("<h3/>"));$("#yourPosts h3").text("You have nothing to show here yet, but you can post something now!")}else{t.html("");t.append($("<table/>",{cellpadding:"0",cellspacing:"0"}));$(e).find("school").each(function(){var e=$(this).attr("shortName");var n=$(this).attr("longName");t.find("table").append($("<tr/>",{id:e}));t.find("table #"+e).append($("<th/>",{width:"60%",colspan:"3"})).append($("<th/>",{width:"30%"})).append($("<th/>",{width:"10%"}));t.find("table #"+e+" th:first").text(n);t.find("table #"+e+" th:nth-child(2)").text("Posted/Renewed");t.find("table #"+e+" th:nth-child(3)").text("views");var r=t.find("table");$(this).find("post").each(function(){var e=$(this).attr("id");var t=$(this).attr("link");var n=$(this).attr("category");var i=$(this).attr("title");var s=$(this).attr("date");var o=$(this).attr("views");var u=$(this).attr("expire");var a=$(this).attr("expired");if(a=="false"){if(u==-1){r.append('<tr id="'+t+'" class="'+n+'"><td width="2%"><a href="javascript:deletePost(\''+t+'\')"><i class="sprite sprite-1396379273_86"></i></a></td> <td width="2%"><a href="javascript:popup(\'editPost?'+t+'\')"><i class="sprite sprite-1396379288_90"></i></a></td> <td><a href="show?'+t+'">'+i+"</a></td><td>"+s+"</td><td>"+o+"</td></tr>")}else{r.append('<tr id="'+t+'" class="'+n+', expiring"><td width="2%"><a href="javascript:deletePost(\''+t+'\')"><i class="sprite sprite-1396379273_86"></i></a></td> <td width="2%"><a href="javascript:popup(\'editPost?'+t+'\')"><i class="sprite sprite-1396379288_90"></i></a></td> <td><a href="show?'+t+'">'+i+"</a></td><td>"+s+"</td><td>"+o+"</td></tr>");console.error("attention")}}else{r.append('<tr id="'+t+'" class="'+n+', expired"><td width="2%"><a href="javascript:deletePost(\''+t+'\')"><i class="sprite sprite-1396379273_86"></i></a></td> <td width="2%"></td> <td><a href="show?'+t+'">'+i+"</a></td><td>"+s+"</td><td>"+o+"</td></tr>");console.error("attention")}})})}$(".expired").mouseenter(function(){n();id=$(this).attr("id");$(this).css({background:"#FF3D3D",color:"#FFFFFF"});if($(this).next().attr("class")!="CFExpired")$('<tr class="CFExpired"><td colspan="5">This post has expired. Click <a href="javascript:renewPost(\''+id+"')\">here</a> to restore it.</td></tr>").insertAfter($(this))});$(".expiring").mouseenter(function(){n();id=$(this).attr("id");$(this).css({background:"#FFBA42",color:"#FFFFFF"});if($(this).next().attr("class")!="CFExpiring")$('<tr class="CFExpiring"><td colspan="5">This post will expire soon. Click <a href="javascript:renewPost(\''+id+"')\">here</a> to restore it.</td></tr>").insertAfter($(this))})})}function getAccountPrefs(e){concat='	<form name="acctPrefs" action="javascript:updateAcctPrefs()" autocomplete="off">';concat+='	<table cellspacing="0px" cellpadding="0px">';concat+='	<tr><th colspan="2">Enter your password</th></tr>';concat+='	<tr><td>Current Password:</td><td><input type="password" name="pword0"></td></tr>';concat+='	<tr><th colspan="2">Update your email</th></tr>';concat+='	<tr><td width="50%">New Email:</td><td width="50%"><input type="text" name="email1"></td></tr>';concat+='	<tr><td>Comfirm:</td><td><input type="text" name="email2"></td></tr>';concat+='	<tr><th colspan="2">Update your password</th></tr>';concat+='	<tr><td>New Password:</td><td><input type="password" name="pword1"></td></tr>';concat+='	<tr><td>Comfirm:</td><td><input type="password" name="pword2"></td></tr>';concat+='	<tr><th colspan="2">Choose your digits</th></tr>';concat+='	<tr><td>Phone Number:</td><td><input type="text" name="phone1"></td></tr>';concat+='	<tr><td colspan="2"><input type="submit" value="Save Changes"></td></tr>';concat+="	</table>";concat+="	</form>";$("#acctMod").html(concat);if(typeof e=="function")e()}function updateAcctPrefs(){var e=document.acctPrefs.email1.value;var t=document.acctPrefs.email2.value;var n=document.acctPrefs.pword0.value;var r=document.acctPrefs.pword1.value;var i=document.acctPrefs.pword2.value;var s=document.acctPrefs.phone1.value;if(n==""){dialog("You must enter your password first.",true);return}var o=true;if(e!=""){if(validateEmail(e)){if(e!=t){dialog("Emails must match.",true);o=false}}else{dialog("Please enter a valid email",true);o=false}}if(r!=""){if(r.length>7){if(r!=i){dialog("Passwords must match.",true);o=false}}else{dialog("Passwords must be 8 characters or longer.",true);o=false}}if(s!=""){if(s.length!=10){dialog("Please enter a valid phone number",true);o=false}}if(o){user=confirm("Are you sure you want to save these changes? This cannot be undone.");if(user){$.ajax({dataType:"html",data:"intent=controlPanel&oldPw="+n+"&email="+e+"&newPw="+r+"&phone="+s,context:user_logout}).success(function(e){switch(e){case"No Act":break;default:dialog(e,true,this);break}})}}}function getProfilePrefs(){concat='<div id="profileImgWrap">';concat+='<img id="avImgElement" src="'+window.avatar.src+'">';concat+='<div id="avMod"><h2>'+window.username+"</h2><hr>";concat+='<p>update profile image: <form id="imageUploadForm"><input type="hidden" name="intent" value="uploadAvatar"> <input name="avatar" type="file" accept="image/jpeg" onchange="getImage(this)"><input value="Save Changes" type="submit"></form></p></div>';concat+="</div>";$("#profileAvatar").html(concat);$("#imageUploadForm").on("submit",function(e){e.preventDefault();var t=new FormData(this);$.ajax({dataType:"html",data:t,contentType:false,processData:false,cache:false}).success(function(e){if(e=="0"){$.ajax({data:"intent=getAvatar"}).done(function(e){window.avatar=new Image;window.avatar.src=e;$("#avatar img").attr("src",window.avatar.src);$("#dd img").attr("src",window.avatar.src)});dialog("We hope you like the new look!",true)}else{dialog(e,true)}})})}function getImage(e){handleImage(e)}function handleImage(e){var t=$("#avImgElement");if(e.files&&e.files[0]){window.img=e.files[0];var n=new FileReader;n.onload=function(e){t.attr("src",e.target.result)};n.readAsDataURL(e.files[0])}}function updateEmailPref(e){e=e?1:0;$.ajax({dataType:"html",data:"intent=setEmailPref&pref="+e,context:refreshEmailPref}).success(function(e){if(e!=0)dialog(e,true);else refreshEmailPref})}function refreshEmailPref(){$.ajax({dataType:"html",data:"intent=getEmailPref",context:refreshEmailPref}).success(function(e){if(e=="1")$("#emailPfefCheckBox").attr("checked","checked");else $("#emailPfefCheckBox").removeAttr("checked")})}function deletePost(e){dialog("Are you sure you want to delete this post? This cannot be undone.",true,null,function(t){if(t){$.ajax({dataType:"html",data:"intent=removePost&"+e+"=",context:getUserPosts}).success(function(e){if(e=="success"){this()}else{dialog(e)}})}})}function renewPost(e){$.ajax({dataType:"html",data:"intent=renewPost&"+e+"=",context:getUserPosts}).success(function(e){if(e=="success"){this()}else{dialog(e)}})}function updateHeader(){$("#Nav").find("li").removeAttr("class");$("#"+window.category).attr("class","selected")}function w_sort(e){window.sort=e}function resizeListings(){console.log($(window).width());if($(window).width()>1366){window.perPage=21;$("#mainCWB #dynamicWrapper #dynamicContent #dump li").css("width","calc(14% - 19px)")}else{window.perPage=15;$("#mainCWB #dynamicWrapper #dynamicContent #dump li").css("width","calc(20% - 22px)")}}function updatePage(){if(!window.inhibitUpdate){window.inhibitUpdate=true;$("html, body").animate({scrollTop:0},500);updateHeader();$(window.canvas).slideUp(300,function(){$("#dump").find("ul").empty();$("#message").hide();window.offset=0;pageLoad($("#queryBar").val(),window.school,window.category,window.sort,function(){$(window.canvas).slideDown(300);window.inhibitUpdate=false})})}}function pageLoad(e,t,n,r,i){$.ajax({data:"intent=getPosts&query="+e+"&school="+t+"&cat="+n+"&offset="+window.offset+"&sort="+r+"&amount="+window.perPage+"&ellipse=1"}).success(function(e){var t=$("#dump").find("ul");$(e).find("listing").each(function(){var e=$(this);var n=e.attr("id");var r=e.attr("obsId");var i=e.attr("title");var s=e.attr("category");var o=e.attr("details");var u=e.attr("username");var a=e.attr("price");var f=e.attr("image");var l=e.attr("userid");var c=e.attr("date");var h=e.attr("views");switch(s){case"book":color="rgba(103,137,9,.75)";break;case"tech":color="rgba(55,9,137,.75)";break;case"housing":color="rgba(255,140,0,.75)";break;case"misc":color="rgba(68,211,216,.75)";break;default:color="rgba(0,0,0,.5)";break}t.append($("<a/>",{id:"p_"+n,href:"/show?"+r}));$("#p_"+n).append($("<li/>"));$("#p_"+n+" li").append($("<div/>",{"class":"title"})).append($("<div/>",{"class":"image"})).append($("<div/>",{"class":"price"})).append($("<div/>",{"class":"username"})).append($("<div/>",{"class":"details"})).append($("<div/>",{"class":"categoryTab",style:"background-color:"+color}));$("#p_"+n+" li").find(".title").append($("<h4/>"));$("#p_"+n+" li").find(".title h4").text(i);$("#p_"+n+" li").find(".image").append($("<img/>",{src:f}));$("#p_"+n+" li").find(".price").text(a);$("#p_"+n+" li").find(".username").text(u);$("#p_"+n+" li").find(".details").text(o);$("#p_"+n+" li").find(".categoryTab").text(s);resizeListings()});if($(e).find("listing").length==0){if(window.offset==0)$("#message").show()}else{window.scrolling=true}if(typeof i=="function")i();window.offset+=window.perPage})}function createMessageWindow(e,t,n,r){var i='<form name="contact" action="javascript:messageUser()">	<input type="hidden" name="uid" value="'+e+'">	<input type="hidden" name="title" value="'+t+'">	<table id="messageWindow">		<tr>			<th>Email '+n+'</th>		</tr>		<tr>			<td><textarea name="message">'+r+'</textarea></td>		</tr>		<tr>			<td><span id="response"></span></td>		</tr>		<tr>			<td><input type="submit" value="send"></td>		</tr>	</table>	</form>';dialog(i,false)}function messageUser(){var e=document.contact.uid.value;var t=document.contact.title.value;var n=document.contact.message.value;if(n.length<20){$("#response").html("your message is too short");return}else{$("#response").html("")}$.ajax({url:"/api/",dataType:"html",type:"POST",data:"intent=messageUser&uid="+e+"&title="+t+"&message="+n}).success(function(e){var t=document.getElementById("response");switch(e){case"success":dialog("Your message was sent successfully",true,null,function(){window.location="./"});break;default:dialog(e,false);break}})}function validateEmail(e){var t=e.indexOf("@");var n=e.lastIndexOf(".");tld=e.substring(e.length-3,e.length);if(t<1||n<t+2||n+2>=e.length){return false}if(e.match(/\s/g)){return false}return true}function user_logout(){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=logout"}).success(function(e){window.location="/"})}function createLoginWindow(){$("body").prepend('<div id="screen"></div>');$("#screen").css("display","none");$("#screen").load("/include/login_window.html");$("#screen").fadeIn(function(){$("#emailBox").focus();$("body").keydown(function(e){if(e.keyCode==27)destroyLoginWindow()});$("#screen").click(function(e){if(e.target!=this)return;destroyLoginWindow()});$("body").keypress(function(e){if(e.which==27){destroyLoginWindow()}})})}function destroyLoginWindow(){$("#screen").fadeOut(function(){$("#screen").remove()})}function resetPassword(){dialog("<h1>Enter your email address</h1>		<p>We will send you a temporary password to your email.</p>		<form name ='passwordResetForm' action='javascript:commitPwReset()'>		<p>		<input type='text' name='email' placeholder='johndoe@example.com'>		</p>		<p>		<input type='submit' class='button'  value='Ok!'>		</p>		</form>",false)}function commitPwReset(e){var t=document.passwordResetForm.email.value;if(validateEmail(t)){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=resetPassword&email="+t}).success(function(e){dialog(e,true)})}}function user_login(){var e=document.login.username.value;var t=document.login.password.value;var n=document.login.rememberMe.checked;if(e==""){$("#response").html('<font color="#FF0000">Please enter an email address.</font>');return}if(e!=""){if(validateEmail(e)){$("#response").html("")}else{$("#response").html('<font color="#FF0000">Please enter a valid email address.</font>');return}}if(t==""){$("#response").html('<font color="#FF0000">Please enter a password.</font>');return}else if(t!=""){$("#response").html("")}$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=login&email="+e+"&password="+t+"&rememberMe="+n}).success(function(e){switch(e){case"success":window.location="/";break;case"reset":dialog("<p><h1>It seems like you're having trouble</h1> If you forgot your password click the link below to reset it.</p><p><a href='javascript:resetPassword()'>Send me a new password!</a></p>");break;case"verify":dialog('<form name="code" method="GET" action="/validateKey">				<p>				<h1> Oops, your account isn\'t verified yet</h1>				<p>We\'ve sent you an email containing activation instructions. Don\'t forget to check your spam folder! </p>				<p>You may enter your verification code here if you wish, or simply click the link in the email</p>				<br>				<input name="token" placeholder="xxxxxx" maxlength="6" class="codeInput" style="width:6em"></p>				</p>				<p>				<input type="submit" class="button" style="color:#FFF" value="OK">				</p>				</form>',false);break;default:$("#response").html('<font color="#FF0000">'+e+"</font>");break}})}function checkUname(e){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=checkUsername&username="+e}).success(function(t){if(t==0){document.getElementById("1Err").innerHTML="";window.no_user_error=true}else{document.getElementById("1Err").innerHTML="*"+e+" is taken.";window.no_user_error=false}})}function user_add(){var e=document.useradd.usernameSignup.value;var t=document.useradd.emailSignup.value;var n=document.useradd.phoneSignup.value;var r=document.useradd.passwordSignup.value;var i=document.useradd.password2Signup.value;if(e!=""){checkUname(e);if(e.length<5||e.length>20){$("#1Err").html("*Username must be between 5 and 20 characters.");window.no_user_error=false}else if(e.match(/\s/g)){$("#1Err").html("*Username may not contain spaces.");window.no_user_error=false}else{$("#1Err").html("")}}else{$("#1Err").html("*Please enter a username.");window.no_user_error=false}if(t!=""){var s=t.indexOf("@");var o=t.lastIndexOf(".");tld=t.substring(t.length-3,t.length);if(s<1||o<s+2||o+2>=t.length){$("#2Err").html("*Please enter a valid email address.");window.no_user_error=false}else if(tld!="edu"){$("#2Err").html("*Please use your student (.edu) email address.");window.no_user_error=false}else if(t.match(/\s/g)){$("#2Err").html("*Please enter a valid email address.");window.no_user_error=false}else{$("#2Err").html("")}}else{$("#2Err").html("*Please enter an email address.");window.no_user_error=false}n=n.replace(/[^0-9.]/g,"");if(n!=""){if(n.length!=10){$("#phoneErr").html("Please enter a valid phone number.");window.no_user_error=false}else{$("#phoneErr").html("")}}else{$("#phoneErr").html("");n=0}if(r!=""){if(r.length<8){window.no_user_error=false;$("#3Err").html("*password must be at least 8 characters.")}else{$("#3Err").html("")}}else{window.no_user_error=false;$("#3Err").html("*Please enter a password.")}if(r!=i){window.no_user_error=false;$("#4Err").html("*Passwords do not match.")}else{$("#4Err").html("")}if(window.no_user_error){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=addUser&username="+e+"&email="+t+"&password="+r+"&phone="+n}).success(function(e){switch(e){case"0":window.location="/validateKey";break;case"3":$("#2Err").html("This email address is in use!");break;default:dialog(e);window.location("./");break}})}else window.no_user_error=true}function handleResponse(e){if(e.match(/^[a-f0-9]/)!==null){sendFiles(e)}else{dialog(e)}}function addBook(){var e=books.elements["Title"].value;var t=books.elements["Author"].value;var n=books.elements["Details"].value;var r=books.elements["ISBN"].value;var i=books.elements["Price"].value;var s=books.elements["Tags"].value;var o=document.getElementById("errTitle");var u=document.getElementById("errAuth");var a=document.getElementById("errDescription");var f=document.getElementById("errIsbn");var l=document.getElementById("errPrice");var c=document.getElementById("errTags");var h=true;if(e!=""){if(e.length<2){o.innerHTML="You're bluffing.";h=false}else{if(e.length>150){o.innerHTML="I'm too lazy to read this... Please make it shorter.";h=false}else{o.innerHTML=""}}}else{o.innerHTML="Please enter a title.";h=false}if(t!=""){if(t.length<2){u.innerHTML="Check that author name again...";h=false}else{if(t.length>50){u.innerHTML="Your author's name is long enough to fill the book...";h=false}else{u.innerHTML=""}}}else{u.innerHTML="Please enter an author.";h=false}if(n!=""){if(n.length<5){a.innerHTML="Your details are too short.";h=false}else{if(n.length>3e3){a.innerHTML="Your details are too long, please limit to 3000 characters.";h=false}else{a.innerHTML=""}}}else{a.innerHTML="Please enter details about your listing.";h=false}if(r!=""){r=r.replace(/[^0-9]/g,"");if(r.length==10||r.length==13){f.innerHTML=""}else{f.innerHTML="Please enter a valid ISBN-10 or ISBN-13 number.";h=false}}i=i.replace(/[^0-9.]/g,"");if(s!=""){if(s.length<5){c.innerHTML="Please use more descriptive tags.";h=false}else{c.innerHTML=""}}else{c.innerHTML="Please enter tags to describe your post";h=false}if(h){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=addPost&cat=book&title="+e+"&author="+t+"&details="+n+"&price="+i+"&isbn="+r+"&tags="+s}).success(handleResponse)}}function addElectronics(){var e=electronics.elements["Name"].value;var t=electronics.elements["Details"].value;var n=electronics.elements["Price"].value;var r=electronics.elements["Tags"].value;var i=document.getElementById("errTitle");var s=document.getElementById("errDescription");var o=document.getElementById("errPrice");var u=document.getElementById("errTags");var a=true;if(e!=""){if(e.length<2){i.innerHTML="You're bluffing.";a=false}else{if(e.length>150){i.innerHTML="I'm too lazy to read this... Please make it shorter.";a=false}else{i.innerHTML=""}}}else{i.innerHTML="Please enter a title.";a=false}if(t!=""){if(t.length<5){s.innerHTML="Your details are too short.";a=false}else{if(t.length>3e3){s.innerHTML="Your details are too long, please limit to 3000 characters.";a=false}else{s.innerHTML=""}}}else{s.innerHTML="Please enter details about your listing.";a=false}n=n.replace(/[^0-9.]/g,"");if(r!=""){if(r.length<5){u.innerHTML="Please use more descriptive tags.";a=false}else{u.innerHTML=""}}else{u.innerHTML="Please enter tags to describe your post";a=false}if(a){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=addPost&cat=tech&title="+e+"&details="+t+"&price="+n+"&tags="+r}).success(handleResponse)}}function addHousing(){var e=housing.elements["Name"].value;var t=housing.elements["Details"].value;var n=housing.elements["Price"].value;var r=housing.elements["Tags"].value;var i=document.getElementById("errTitle");var s=document.getElementById("errDescription");var o=document.getElementById("errImage");var u=document.getElementById("errPrice");var a=document.getElementById("errTags");var f=true;if(e!=""){if(e.length<2){i.innerHTML="You're bluffing.";f=false}else{if(e.length>150){i.innerHTML="I'm too lazy to read this... Please make it shorter.";f=false}else{i.innerHTML=""}}}else{i.innerHTML="Please enter a title.";f=false}if(t!=""){if(t.length<5){s.innerHTML="Your details are too short.";f=false}else{if(t.length>3e3){s.innerHTML="Your details are too long, please limit to 3000 characters.";f=false}else{s.innerHTML=""}}}else{s.innerHTML="Please enter details about your advertisement.";f=false}n=n.replace(/[^0-9.]/g,"");if(r!=""){if(r.length<5){a.innerHTML="Please use more descriptive tags.";f=false}else{a.innerHTML=""}}else{a.innerHTML="Please enter tags to describe your post";f=false}if(uploadedImages<2){o.innerHTML="You must have at least 2 images for this type of post";f=false}if(f){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=addPost&cat=housing&title="+e+"&details="+t+"&price="+n+"&tags="+r}).success(handleResponse)}}function addMisc(){var e=miscellaneous.elements["Title"].value;var t=miscellaneous.elements["Details"].value;var n=miscellaneous.elements["Tags"].value;var r=document.getElementById("errTitle");var i=document.getElementById("errDescription");var s=document.getElementById("errTags");var o=true;if(e!=""){if(e.length<2){r.innerHTML="We need a longer name here.";o=false}else{if(e.length>150){r.innerHTML="Too long buddy. Let's shorten it a bit ;)";o=false}else{r.innerHTML=""}}}else{r.innerHTML="Please enter a title.";o=false}if(t!=""){if(t.length<5){i.innerHTML="Your details are too short.";o=false}else{if(t.length>3e3){i.innerHTML="Your details are too long, please limit to 3000 characters.";o=false}else{i.innerHTML=""}}}else{i.innerHTML="Please enter details about your event.";o=false}if(n!=""){if(n.length<5){s.innerHTML="Please use more descriptive tags.";o=false}else{s.innerHTML=""}}else{s.innerHTML="Please enter tags to describe your post";o=false}if(o){$.ajax({url:api_url,dataType:"html",type:"POST",data:"intent=addPost&cat=misc&title="+e+"&details="+t+"&tags="+n}).success(handleResponse)}}function initDropBox(){var e=document.getElementById("imgDrop");e.addEventListener("dragenter",dragenter,false);e.addEventListener("dragover",dragover,false);e.addEventListener("drop",drop,false)}function dragenter(e){e.stopPropagation();e.preventDefault()}function dragover(e){e.stopPropagation();e.preventDefault()}function drop(e){e.stopPropagation();e.preventDefault();var t=e.dataTransfer;var n=t.files;handleFiles(n,imgDrop)}function getImages(e){handleFiles(e.files,imgDrop)}function handleFiles(e,t){for(var n=0;n<e.length;n++){var r=e[n];var i=/image.jpeg/;if(uploadedImages<3&&!r.type.match(i)){alert("Sorry, only JPEG images are allowed at this time.");continue}if(uploadedImages<3&&r.size>5242880){alert("This image exceeds the 5MB limit.");continue}if(uploadedImages>3){alert("You have reached the limit of 4 images.");break}if(clear){imgDrop.innerHTML="";clear=false}uploadedImages++;var s=document.createElement("img");s.classList.add("obj");s.file=r;t.appendChild(s);var o=new FileReader;o.onload=function(e){return function(t){e.src=t.target.result}}(s);o.readAsDataURL(r)}}function sendFiles(e){function n(e,t,r,i){if(t<0){return i("success")}if(window.XMLHttpRequest){xhttp=new XMLHttpRequest}else{xhttp=new ActiveXObject("Microsoft.XMLHTTP")}xhttp.open("POST","/api/",true);form=new FormData;form.append("intent","uploadPostImages");form.append("identifier",r);form.append("iteration",t);form.append("image",e[t].file);xhttp.send(form);xhttp.onreadystatechange=function(){if(xhttp.readyState==4&&xhttp.status==200){if(xhttp.responseText=="0"){if(typeof i=="function"){return n(e,t-1,r,i)}}else{console.log(xhttp.responseText);return i("An error has occured while processing some images. They may not be included in your post.")}}}}function r(e){document.getElementById("throbber").style.display="none";if(e!="success")alert(e);window.location="user_settings"}var t=document.querySelectorAll(".obj");document.getElementById("throbber").style.display="block";n(t,t.length-1,e,r)}function formatPrice(e){value=e.value;if(value!=""){value=value.replace(/[^0-9.]/g,"");if(value.charAt(0)!="$")e.value="$"+value}}function blowupImage(e){if(e.target.id=="noImg")return;var t=$("#"+e.target.id).attr("src");$("body").prepend('<div id=\'screen\'><div id="imageLargeFloat"><img src="'+t+'"></div></div>');$("#screen").css("display","none");$("#screen").fadeIn();$("#screen").click(function(){$("#screen").fadeOut(function(){$("#screen").remove()})});$("body").keydown(function(e){if(e.keyCode==27)$("#screen").fadeOut(function(){$("#screen").remove()})})}window.api_url="/api/";window.resultsPageActive=false;$(document).ready(function(){initFeedbackSlider();pollNewMessages()})